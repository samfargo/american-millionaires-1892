# Development notes

This file captures internal project details, scripts, and website implementation notes
that are too detailed for the public README.

## Project goal
Turn a messy, static 1892 printed list of "millionaires" into a clean,
trustworthy, explorable public resource: a simple website where anyone can search names,
browse by state and city, and understand the broader patterns (state totals and industry
breakdowns).

## Repository contents
- `Data/output_remove_est.csv`: Primary input CSV of individuals. Must include
  `State` and `City` columns.
- `Scripts/build_site_data.py`: Builds the JSON indices used by the static site.
- `Scripts/count_by_state.py`: Reads a CSV and writes state totals plus state/city
  breakdowns to `Data/counts_from_csv`.
- `Data/counts_from_csv`: Generated output from `Scripts/count_by_state.py` (state totals
  at top, then state/city detail).
- `Data/location_counts_OCR.csv`: Pipe-delimited historical totals in the form
  `State|Category|Count`, including rows where `Category` is `Total`.
- `Scripts/compare_state_counts.py`: Compares totals from `Data/counts_from_csv` to `Total`
  rows in `Data/location_counts_OCR.csv`.
- `Data/all_states_industry_count.csv`: Category totals across all locations (not state-based).
- `site/`: Static website (HTML/CSS/JS). JSON indices are written to
  `site/assets/records/`.
- `Archive/output_raw.csv`, `Archive/example_page.png`, `Scans/`: Supporting artifacts.

## Data types in this project
- Source scans: page images from the original book in `Scans/`, plus a sample in
  `Archive/example_page.png`.
- Raw OCR/ingest artifacts: unnormalized extraction outputs in
  `Archive/output_raw.csv`.
- Clean individual records: normalized person-level rows in `Data/output_remove_est.csv`
  with `State` and `City`.
- Aggregated counts (derived): state totals and state/city breakdowns generated by
  `Scripts/count_by_state.py` in `Data/counts_from_csv`.
- Historical location totals (OCR): pipe-delimited `State|Category|Count` rows in
  `Data/location_counts_OCR.csv`, including `Category=Total` rows per state.
- Industry totals (all locations): category totals across the full dataset in
  `Data/all_states_industry_count.csv`.

## Usage

### 1) Generate state totals from the main CSV
```bash
python3 Scripts/count_by_state.py
```
By default this reads `Data/output_remove_est.csv` and writes
`Data/counts_from_csv`.
You can pass a different CSV path as the first argument:
```bash
python3 Scripts/count_by_state.py path/to/your.csv
```

### 2) Compare totals with historical location totals
```bash
python3 Scripts/compare_state_counts.py
```
This prints only differences by default. To show all states:
```bash
python3 Scripts/compare_state_counts.py --all
```
You can also override input paths:
```bash
python3 Scripts/compare_state_counts.py --counts-file Data/counts_from_csv --location-file Data/location_counts_OCR.csv
```

### 3) Build website JSON indices
```bash
python3 Scripts/build_site_data.py
```
This writes JSON files to `site/assets/records/` for the static website.

## Normalization rules in comparisons
`Scripts/compare_state_counts.py` normalizes labels to improve matching:
- Case and punctuation are normalized (e.g., `New-York` -> `NEW YORK`).
- `New-York State` and `New-York City` are combined into a single
  `NEW YORK` total.
- A combined label like `Alaska and Arizona` with a zero total is split into
  separate zero totals.

## Output
`Scripts/compare_state_counts.py` prints a table with columns:
- `STATE`: normalized state name
- `COUNTS`: total from `Data/counts_from_csv`
- `LOCATION_TOTAL`: total from `Data/location_counts_OCR.csv` `Total` rows
- `DIFF`: `COUNTS - LOCATION_TOTAL` (or `NA` if one side is missing)

## Website spec (current)

### Hosting
Deploy the static site to Cloudflare Pages (assets + JSON only, no server).

### Data shipped to the browser
The build script generates JSON indices under `site/assets/records/`:
- `people_index.json`: search table data.
- `state_city_counts.json`: state totals with city breakdowns.
- `state_totals.json`: state totals (from `Data/counts_from_csv`).
- `industry_totals.json`: industry totals (from `Data/all_states_industry_count.csv`).

`people_index.json` fields:
- `id` (stable slug)
- `name`
- `state`
- `city`
- `desc`
- `name_norm` (precomputed lowercase/stripped for speed)
- `state_norm`
- `city_norm`
- `desc_norm`

### Search/filter UX
On `/directory`:
- Search box (filters as you type)
- State dropdown
- City dropdown (dependent on state)
- Results table with columns: Name | State | City | Description
- "Back to top" link that follows scroll

On `/overview`:
- State totals table (sortable by column)
- City totals by state (select a state, sortable by column)
- Industry totals table
- "Back to top" link that follows scroll

### Implementation details
- Debounce keypresses (~80ms).
- Precompute normalized strings once for fast filtering.
- Filter in this order for speed: state/city first, then text match.
- Use `innerHTML` rendering for efficiency.
- No fuzzy matching.
- Provide basic no-JS content and progressively enhance.

### Site structure
- `/` Home
- `/directory` Interactive search
- `/overview` State totals, city totals, industry totals

## Future
1. Add a section about states with no millionaires.
2. Add notable names section: vanderbilt, rockefeller, jp morgan, twain,
3. Add Contact tab.
